<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta charset="utf-8">
</head>
<body>

<style>
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }
</style>
<h2>Конвертер форматов для Квадрата Пифагора</h2>
<input type="file" id="files" name="files[]" multiple />
<output id="list"></output>
<br/>
<br/>
<textarea id="myTextarea" style="height:300px;width:100%" placeholder="Результат">
</textarea>

<script>
	
  function isNotEmpty(str) {
  	return str && str.trim() != '';
  }

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

	var result = "";

    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
          // Render thumbnail.
          //console.log(e.target.result);
          
          var el = document.createElement( 'html' );
		  el.innerHTML = e.target.result;
          
          //alert(el.getElementsByClassName('MsoTableGrid').length);
          
          
          var tables = el.getElementsByClassName('MsoTableGrid');
          for(var i = 0; i < tables.length; i++) {
            var table = tables[i];
            var personName1 = table.rows[0].cells[0].getElementsByTagName('span')[0].innerText;
            var day1 = table.rows[1].cells[0].getElementsByTagName('span')[0].innerText;
            var month1 = table.rows[1].cells[1].getElementsByTagName('span')[0].innerText;
            var year1 = table.rows[1].cells[2].getElementsByTagName('span')[0].innerText;
            if(isNotEmpty(personName1) && isNotEmpty(day1) && isNotEmpty(month1) && isNotEmpty(year1)) {
            	result = result + day1 + "." + month1 + "." + year1 + ";" + personName1 + "\n";
            }
            
            var personName2 = table.rows[0].cells[0+1].getElementsByTagName('span')[0].innerText;
            var day2 = table.rows[1].cells[0+6].getElementsByTagName('span')[0].innerText;
            var month2 = table.rows[1].cells[1+6].getElementsByTagName('span')[0].innerText;
            var year2 = table.rows[1].cells[2+6].getElementsByTagName('span')[0].innerText;
            if(isNotEmpty(personName2) && isNotEmpty(day2) && isNotEmpty(month2) && isNotEmpty(year2)) {
            	result = result + day2 + "." + month2 + "." + year2 + ";" + personName2 + "\n";
            }
          }
          document.getElementById("myTextarea").value = result;
          console.log(result);
        };
      })(f);

      // Read in the image file as a data URL.
      reader.readAsText(f,'windows-1251');
    }
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>

</body>
</html>
