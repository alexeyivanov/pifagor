<meta http-equiv="Refresh" content="0; http://91.211.146.94:8082/pifagor/app" />
<!DOCTYPE html>
<html>
<head>

<title>Квадрат Пифагора</title>
<style>
<!--
table {
	float:left;
    border: 5px solid white;
	border-spacing: 0px;
	border-collapse: collapse;
}
table td {
	border: 1px solid black;
}
table td 
{
  table-layout:fixed;
  width:50px;
  height:20px;
  overflow:hidden;
  word-wrap:break-word;
  text-align:center;
}
-->
table {
	border-spacing:0;
	border-collapse: collapse;
	float:left;
	margin: 5px;
	border-spacing:0;
}

table, td, th {
  border: 1px solid black;
}
table td 
{
  table-layout:fixed;
  width:50px;
  height:20px;
  overflow:hidden;
  word-wrap:break-word;
  text-align:center;
}

</style>
</head>
<body>

<h2>Расчёт Квадрата Пифагора</h2>
<div>
<form autocomplete="off">
  <input type="text" id="myText" value="26.05.1799;Пушкин" autocomplete="off" style="width:100%" onkeypress="return enterPressed(event)">
  <textarea id="myTextarea" style="height:100px;width:100%">
26.10.1879;Троцкий
13.03.1961;Елена Малышева
	</textarea>

</form>
<br/>
</div>
<button onclick="calcPifagors()">Расcчитать</button>
<input type="button" value="Копировать Данные"    onclick="SelectContent('copycontent');">
<button onclick="switchInputMode()">Один/Несколько Человек</button>
<br/>
<br/>
<div id="copycontent">
	<div id=tables style=""></div>
</div>
<script>

var editMode = 0; //0 - single, 1 - multiple
showHideInputs();

function switchInputMode() {
	editMode = editMode == 0 ? 1 : 0;
	showHideInputs();
	calcPifagors();
}

function showHideInputs() {
	var myText = document.getElementById("myText");
	var myTextarea = document.getElementById("myTextarea");
	if(editMode == 0) {
		myText.style.display = "block";
		myTextarea.style.display = "none";
	} else {
		myText.style.display = "none";
		myTextarea.style.display = "block";
	}
}

function enterPressed(e) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        calcPifagors();
        return false;
    }
}

var C_GREEN = '#e6ffe6';
var C_RED = '#ffe6e6';
var C_YELLOW = "#fff5e6";
var pifagorTablePrefix = 'pifagorTable_';

var C_RED_BOLD = "font-family:Calibri;font-size:14px;color:#c00000;font-weight:bold;";
var C_BLUE_BOLD = "font-family:Calibri;font-size:14px;color:#00b0f0;font-weight:bold;border: 1px double #f79646;";
var C_LIGHT_DARK_BOLD = "font-family:Calibri;font-size:14px;color:#bfbfbf;font-weight:bold;";
var C_LIGHT_DARK_BOLD_15 = "font-family:Calibri;font-size:15px;color:#bfbfbf;font-weight:bold;";
var C_BLACK_ITALIC = "font-family:Calibri;font-size:12px;color:#000000;font-style:italic;";
var C_BLACK_NORMAL = "font-family:Calibri;font-size:13px;color:#000000;";

var C_BORDER_ORANGE_LB = "border-left: 1px solid #f79646;border-bottom: 1px solid #f79646;";
var C_BORDER_BLACK_LB = "border-left: 1px solid black;border-bottom: 1px solid black;";

function generatePifagorTable(index, personName) {
	
	var row;
    //cell=new Array();
    var tab=document.createElement('table');
    tab.setAttribute('id', pifagorTablePrefix + index);
   //tab.setAttribute('style','float:left;');

    document.getElementById('tables').appendChild(tab);
    
    var row;
    var rowIndex = 0;
    
    // header
    row = tab.insertRow(rowIndex++);
    var cell = row.insertCell(0);
    cell.setAttribute('colspan', 6);
	cell.setAttribute('style', C_RED_BOLD);
    cell.innerHTML = personName;
    
    // 1 row
    insertCells(
    	tab.insertRow(rowIndex++), 
    	['','','','','',''],
		[C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD,C_RED_BOLD,C_LIGHT_DARK_BOLD_15,C_LIGHT_DARK_BOLD_15], 
    	['&nbsp;','&nbsp;','&nbsp;','&nbsp;','','']
    );
    
    // 2 row
    insertCells(
    	tab.insertRow(rowIndex++), 
		['','','','','',''],
    	['','','',C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD_15],
    	['&nbsp;','&nbsp;','&nbsp;','&nbsp;','&nbsp;','']
    );
    
    // 3 row
    insertCells(
    	tab.insertRow(rowIndex++), 
    	['','','','','',''], 
		[C_BLUE_BOLD,C_BLUE_BOLD,C_BLUE_BOLD,C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD,C_LIGHT_DARK_BOLD],
    	['&nbsp;','&nbsp;','&nbsp;','&nbsp;','&nbsp;','&nbsp;']
    );
    
    // 4 row
    insertCells(
    	tab.insertRow(rowIndex++),
    	['','','','','',''],
		[C_BLUE_BOLD,C_BLUE_BOLD,C_BLUE_BOLD,'',C_BLACK_ITALIC,C_BLACK_ITALIC],
    	['&nbsp;','&nbsp;','&nbsp;','&nbsp;','1столб','2столб']
    );
    
    // 5 row
    insertCells(
    	tab.insertRow(rowIndex++), 
    	['','','','','',''], 
		[C_BLUE_BOLD,C_BLUE_BOLD,C_BLUE_BOLD,'',C_BLACK_NORMAL,C_BLACK_NORMAL],
    	['&nbsp;','&nbsp;','&nbsp;','&nbsp;','&nbsp;','&nbsp;']
    );
}

function insertCells(row, bgColors, styles, values) {
	for(var i = 0; i < bgColors.length; i++) {
    	var cell = row.insertCell(i);
        if(bgColors[i]) {
            cell.setAttribute('bgcolor', bgColors[i]);
        }
		if(styles[i]) {
			cell.setAttribute('style', styles[i]);
        }
        cell.innerHTML = values[i];
    }
}

function parseDate(str) {
    var dateParts = str.split(".");
    if (dateParts.length != 3)
        return null;
    var year = dateParts[2];
    var month = dateParts[1];
    var day = dateParts[0];

    if (isNaN(day) || isNaN(month) || isNaN(year))
        return null;

    var result = new Date(year, (month - 1), day);
    if (result == null)
        return null;
    if (result.getDate() != day)
        return null;
    if (result.getMonth() != (month - 1))
        return null;
    if (result.getFullYear() != year)
        return null;

    return result;
}

function repeats(str, count) {
	return Array(count+1).join(str);
}

function calcPifagor(dataBirthday, personName) {
    
    if (parseDate(dataBirthday) == null) {
      alert(dataBirthday + " не корректная дата рождения (Пример 02.01.1984)");
      return;
    }
    
    var dataBirthdaySplited = dataBirthday.split(".");
    
    if(dataBirthdaySplited.length != 3) {
    	alert(dataBirthday + " не корректная дата рождения (Пример 02.01.1984)");
        return;
    }
    
    var day = dataBirthdaySplited[0];
    if(day.length != 2) {
    	alert(dataBirthday + " не корректная дата рождения (Пример 02.01.1984)");
        return;
    }
    
    var dayInt = parseInt(day);
    var day1 = parseInt(day.charAt(0));
    var day2 = parseInt(day.charAt(1));
    
    var month = dataBirthdaySplited[1];
    if(month.length != 2) {
    	alert(dataBirthday + " не корректная дата рождения (Пример 02.01.1984)");
        return;
    }
    var monthInt = parseInt(month);
    var month1 = parseInt(month.charAt(0));
    var month2 = parseInt(month.charAt(1));
    
    var year = dataBirthdaySplited[2];
    if(year.length != 4) {
    	alert(dataBirthday + " не корректная дата рождения (Пример 02.01.1984)");
        return;
    }
    var yearInt = parseInt(year);
    var year1 = parseInt(year.charAt(0));
    var year2 = parseInt(year.charAt(1));
    var year3 = parseInt(year.charAt(2));
    var year4 = parseInt(year.charAt(3));
    
    var A = dayInt + monthInt + year1 + year2 + year3 + year4;
    if(A > 59) {
    	var AStr = A.toString();
        var A1 = parseInt(AStr.charAt(0));
    	var A2 = parseInt(AStr.charAt(1));
        A = A1 + A2;
    }
    
    var B = day1 + day2 + month1 + month2 + year1 + year2 + year3 + year4;
    
    var V = B;
    if(B > 9) {
    	var BStr = B.toString();
        var B1 = parseInt(BStr.charAt(0));
    	var B2 = parseInt(BStr.charAt(1));
        V = B1 + B2;
    }
    
    var G;
    if(yearInt >= 1900 && yearInt < 2000) {
    	G = -2;
    } else if(yearInt >= 2000) {
    	G = +19;
    } else if(yearInt >= 1700 && yearInt < 1900) {
    	G = +29;
    } else {
    	alert("Данный год не расчитать. Доступный год с 1700 и позже");
		return;
    }
    
    var D = B + G;
    
    var E = D;
    if(E > 9) {
    	var DStr = D.toString();
        var D1 = parseInt(DStr.charAt(0));
    	var D2 = parseInt(DStr.charAt(1));
        E = D1 + D2;
    }
    
    var commonStr = day + month + year + B + V + G + D + E;
    
    var count1 = (commonStr.match(/1/g) || []).length;
    var count2 = (commonStr.match(/2/g) || []).length;
    var count3 = (commonStr.match(/3/g) || []).length;
    var count4 = (commonStr.match(/4/g) || []).length;
    var count5 = (commonStr.match(/5/g) || []).length;
    var count6 = (commonStr.match(/6/g) || []).length;
    var count7 = (commonStr.match(/7/g) || []).length;
    var count8 = (commonStr.match(/8/g) || []).length;
    var count9 = (commonStr.match(/9/g) || []).length;
    
    var stolb1 = count1 * 1 + count2 * 2 + count3 * 3;
    var stolb2 = count4 * 4 + count5 * 5 + count6 * 6;
    
    //alert(stolb1);
    //alert(stolb2);
    
    var pifagorTableId = uuidv4();
    generatePifagorTable(pifagorTableId, personName);
    
    var rowIndex = 1;
    var pifagorTableId = pifagorTablePrefix + pifagorTableId; 
    console.log(document.getElementById(pifagorTableId));
    // 1 row
    document.getElementById(pifagorTableId).rows[rowIndex].cells[0].innerHTML = day;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[1].innerHTML = month;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[2].innerHTML = year;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[3].innerHTML = A; //'А=' + A;
    
    // 2 row
    rowIndex++;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[3].innerHTML = B; //'Б=' + B;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[4].innerHTML = V; //'В=' + V;
    
    // 3 row
    rowIndex++;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[0].innerHTML = repeats("1",count1);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[1].innerHTML = repeats("4",count4);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[2].innerHTML = repeats("7",count7);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[3].innerHTML = G > 0 ? "+" + G : G; //'Г=' + G;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[4].innerHTML = D; //'Д=' + D;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[5].innerHTML = E; //'Е=' + E;
    
    // 4 row
    rowIndex++;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[0].innerHTML = repeats("2",count2);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[1].innerHTML = repeats("5",count5);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[2].innerHTML = repeats("8",count8);
    
    // 5 row
    rowIndex++;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[0].innerHTML = repeats("3",count3);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[1].innerHTML = repeats("6",count6);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[2].innerHTML = repeats("9",count9);
    document.getElementById(pifagorTableId).rows[rowIndex].cells[4].innerHTML = stolb1;
    document.getElementById(pifagorTableId).rows[rowIndex].cells[5].innerHTML = stolb2;
}

function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

function calcPifagors() {
	var divTalbes = document.getElementById('tables');
    //alert(divTalbes);
    while (divTalbes.firstChild) {
      divTalbes.removeChild(divTalbes.firstChild);
  	}
    
    if(editMode == 0) {
		var dataBirthday = document.getElementById("myText").value;
		if(dataBirthday && dataBirthday.trim()) {
			dataBirthday = dataBirthday.trim();
			dataBirthdayArray = dataBirthday.split(";");
			calcPifagor(dataBirthdayArray[0], dataBirthdayArray[1]);
		}
	} else {
		var dataBirthdays = document.getElementById("myTextarea").value.split('\n');
		for(var i = 0 ; i < dataBirthdays.length;i++){
			if(dataBirthdays[i] && dataBirthdays[i].trim()) {
				dataBirthday = dataBirthdays[i].trim();
				dataBirthdayArray = dataBirthday.split(";");
				calcPifagor(dataBirthdayArray[0], dataBirthdayArray[1]);
			}
		}
	}
    
    //alert('as');
	//calcPifagor('01.01.1984', 'Олег Газманов1');
    //calcPifagor('02.01.1984', 'Олег Газманов2');
    //calcPifagor('03.01.1984', 'Олег Газманов3');
    //calcPifagor('04.01.1984', 'Олег Газманов4');
    //calcPifagor('05.01.1984', 'Олег Газманов5');
}
calcPifagors();
//generatePifagorTable(0, 'Олег Газманов');
//generatePifagorTable(1, 'Газманов');
//generatePifagorTable(2, 'Газманов');
//generatePifagorTable(3, 'Газманов');
//generatePifagorTable(4, 'Газманов');
</script>

<script type="text/javascript">
function SelectContent (el) {    
  var aux = document.createElement("div");
  aux.setAttribute("contentEditable", true);
  aux.innerHTML = document.getElementById("copycontent").innerHTML;
  aux.setAttribute("onfocus", "document.execCommand('selectAll',false,null)"); 
  document.body.appendChild(aux);
  aux.focus();
  document.execCommand("copy");
  document.body.removeChild(aux);
}
</script>

</body>
</html>
